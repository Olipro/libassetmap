<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libassetmap: AssetMap Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libassetmap
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">Hash-table based archive format containing compressed data</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">AssetMap Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAssetMap_1_1CityHash.html">CityHash</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAssetMap_1_1DirectoryMetadata.html">DirectoryMetadata</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAssetMap_1_1ICompress.html">ICompress</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAssetMap_1_1IDecompress.html">IDecompress</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAssetMap_1_1IHasher.html">IHasher</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAssetMap_1_1IMemMapper.html">IMemMapper</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAssetMap_1_1MemMappedArchive.html">MemMappedArchive</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAssetMap_1_1MemMappedBucket.html">MemMappedBucket</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAssetMap_1_1MemMappedBucketEntry.html">MemMappedBucketEntry</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAssetMap_1_1MemMapper.html">MemMapper</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAssetMap_1_1ZSTD.html">ZSTD</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ae07862d73c917c7e8ead88e70c5c450d"><td class="memItemLeft" align="right" valign="top"><a id="ae07862d73c917c7e8ead88e70c5c450d"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><b>lam_size_t</b> = LIBARCHIVEMAP_SIZE_TYPE</td></tr>
<tr class="separator:ae07862d73c917c7e8ead88e70c5c450d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:afb63c4af2341a3b324116352481e9039"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:afb63c4af2341a3b324116352481e9039"><td class="memTemplItemLeft" align="right" valign="top">constexpr void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespaceAssetMap.html#afb63c4af2341a3b324116352481e9039">PutValue</a> (uint8_t *buf, T value) noexcept</td></tr>
<tr class="memdesc:afb63c4af2341a3b324116352481e9039"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes any integral value, byte-by-byte to a memory location.  <a href="namespaceAssetMap.html#afb63c4af2341a3b324116352481e9039">More...</a><br /></td></tr>
<tr class="separator:afb63c4af2341a3b324116352481e9039"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af35d1316aa6383619210e493a830a8af"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:af35d1316aa6383619210e493a830a8af"><td class="memTemplItemLeft" align="right" valign="top">constexpr T&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespaceAssetMap.html#af35d1316aa6383619210e493a830a8af">GetValue</a> (const uint8_t *buf) noexcept</td></tr>
<tr class="memdesc:af35d1316aa6383619210e493a830a8af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads any integral value byte-by-byte and return it.  <a href="namespaceAssetMap.html#af35d1316aa6383619210e493a830a8af">More...</a><br /></td></tr>
<tr class="separator:af35d1316aa6383619210e493a830a8af"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae12c7d404774d4208f6f708e8ff72acb"><td class="memItemLeft" align="right" valign="top"><a id="ae12c7d404774d4208f6f708e8ff72acb"></a>
constexpr auto&#160;</td><td class="memItemRight" valign="bottom"><b>PutLamSizeT</b> = <a class="el" href="namespaceAssetMap.html#afb63c4af2341a3b324116352481e9039">PutValue</a>&lt;lam_size_t&gt;</td></tr>
<tr class="separator:ae12c7d404774d4208f6f708e8ff72acb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad584e795053ce45ac2c75441bba9fd86"><td class="memItemLeft" align="right" valign="top"><a id="ad584e795053ce45ac2c75441bba9fd86"></a>
constexpr auto&#160;</td><td class="memItemRight" valign="bottom"><b>GetLamSizeT</b> = <a class="el" href="namespaceAssetMap.html#af35d1316aa6383619210e493a830a8af">GetValue</a>&lt;lam_size_t&gt;</td></tr>
<tr class="separator:ad584e795053ce45ac2c75441bba9fd86"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">An archive is laid out according to the compile-time integer size.
By default this is a uint32_t though it can be changed via CMake.

Target number of buckets is defined by IHasher.
All offsets are specified relative to the beginning of the file. This makes
it easier to inspect values in a hex editor and was chosen since the bucket
table is at the start which would buy very little additional space if it
were made relative to the current pointer. If you need more space, use
64-bit values.

Each file entry is padded to the sizeof() the chosen integer width. This
is not actually required but is designed to avoid the overhead on unaligned
accesses in cases where the compiler knows the CPU would happily read
unaligned data.

All integer values are stored little-endian.

If a dictionary has been used, it is concatenated to the end and a value
indicating its size is appended after it.

A single byte is placed at the end of the file indicating whether a
dictionary is present or not. If the value is anything other than 0 or 1, an
exception will be thrown as this is assumed to indicate a future version.

Assuming a 32-bit size with 2 buckets across 3 files, which all happened to
be compressed to a few bytes each, this would be the layout:

B = bucket
I = Item
+------+----------------------------------+---+---+---+---+---+---+---------------------------+-------------------------+---+---+---+------------------+-----+---------+---------+
|      |                 0                | 1 | 2 | 3 | 4 | 5 | 6 |             7             |            8            | 9 | A | B |         C        |  D  |    E    |    F    |
+------+----------------------------------+---+---+---+---+---+---+---------------------------+-------------------------+---+---+---+------------------+-----+---------+---------+
| 0x00 |              [bucket_count] = 2              |          [B0][offset] = 0xC           |         [B1][offset] = 0x24         |             [B0][I0][size] = 5             |
+------+----------------------------------------------+-----------+---------------------------+-------------------------------------+--------------------------------------------+
| 0x10 |                [B0][I0][name] = "f1.txt\0"               |                       [I0][data] = {bytes}                      |            [B0][Iend][size] = 0            |
+------+----------------------------------+-----------+-----------+---------------------------+-------------------------------------+--------------------------------------------+
| 0x20 |      [B0][Iend][name] = "\0"     | [padding] |           [B1][I0][size] = 5          |                           [B1][I0][name] = "file2.S\0"                           |
+------+----------------------------------+-----------+---+-----------------------------------+-------------------------------------+--------------------------------------------+
| 0x30 |             [B1][I0][data] = {bytes}             |             [padding]             |          [B1][I1][size] = 7         |          [B1][I1][name] = "abc\0"          |
+------+--------------------------------------------------+-------+---------------------------+-------------------------------------+------------------------+-------------------+
| 0x40 |               [B1][I1][data] = {bytes}                   | [B1][I1][padding] = {any} |          [B1][I2][size] = 3         | [B1][I2][name] = "x\0" | [B1][I2][data]... |
+------+----------------------------------+-----------+-----------+---------------------------+-------------------------+-----------+------------------+-----+-------------------+
| 0x50 | ...[B1][I2][data] = {bytes}      | [padding] |          [B1][Iend][size] = 0         | [B1][Iend][name] = "\0" | [padding] |   [hasDict] = 0  |   {EOF} unaddressable.  |
+------+----------------------------------+-----------+---------------------------------------+-------------------------+-----------+------------------+-------------------------+
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="af35d1316aa6383619210e493a830a8af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af35d1316aa6383619210e493a830a8af">&#9670;&nbsp;</a></span>GetValue()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr T AssetMap::GetValue </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>buf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">constexpr</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reads any integral value byte-by-byte and return it. </p>
<dl class="section pre"><dt>Precondition</dt><dd><code>buf</code> must contain at least <code>sizeof(T)</code> bytes. </dd></dl>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>Any integral type </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>The buffer to read the value from. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The integral value read from the buffer. </dd></dl>

</div>
</div>
<a id="afb63c4af2341a3b324116352481e9039"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb63c4af2341a3b324116352481e9039">&#9670;&nbsp;</a></span>PutValue()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr void AssetMap::PutValue </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">T&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">constexpr</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Writes any integral value, byte-by-byte to a memory location. </p>
<pre class="fragment">         It is left to the compiler to determine whether the value can
         be written with an unaligned access or not.
</pre> <dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>When the project is upgraded to C++ 20, alignment hinting be supported to allow using std::assume_aligned. </dd></dl>
<dl class="section pre"><dt>Precondition</dt><dd><code>buf</code> must be able to hold at least <code>sizeof(T)</code> bytes. </dd></dl>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>The integral type to write (deduced) </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>The buffer to write the value into. </td></tr>
    <tr><td class="paramname">value</td><td>The integral value to write </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
